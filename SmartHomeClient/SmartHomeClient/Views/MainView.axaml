<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:SmartHomeClient"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="1200"
             x:Class="SmartHomeClient.Views.MainView"
             Background="#1a1a2e"
             Foreground="White">

    <!-- 定義全域樣式與資源 -->
    <UserControl.Styles>
        <!-- 標題文字 -->
        <Style Selector="TextBlock.h1">
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#4cc9f0"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>
        <Style Selector="TextBlock.h2">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#e94560"/>
            <Setter Property="Margin" Value="0,10,0,5"/>
        </Style>
        <Style Selector="TextBlock.label">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#a0a0a0"/>
        </Style>
        <Style Selector="TextBlock.value">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- 卡片樣式 -->
        <Style Selector="Border.card">
            <Setter Property="Background" Value="#16213e"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="BoxShadow" Value="0 4 8 0 #33000000"/>
            <Setter Property="Margin" Value="5"/>
        </Style>

        <!-- 按鈕樣式 -->
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#0f3460"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#4cc9f0"/>
            <Setter Property="BorderThickness" Value="0,0,0,2"/>
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.primary:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#4cc9f0"/>
            <Setter Property="Foreground" Value="#1a1a2e"/>
        </Style>

        <Style Selector="Button.danger">
            <Setter Property="Background" Value="#5c1a1a"/>
            <Setter Property="BorderBrush" Value="#e94560"/>
            <Setter Property="BorderThickness" Value="0,0,0,2"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- ToggleButton 樣式 -->
         <Style Selector="ToggleButton">
            <Setter Property="Background" Value="#333"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="CornerRadius" Value="5"/>
        </Style>
        <Style Selector="ToggleButton:checked /template/ ContentPresenter">
            <Setter Property="Background" Value="#4cc9f0"/>
            <Setter Property="Foreground" Value="Black"/>
        </Style>
        
        <Style Selector="TabItem">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="Gray"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
        </Style>
        <Style Selector="TabItem:selected">
            <Setter Property="Foreground" Value="#4cc9f0"/>
        </Style>
    </UserControl.Styles>

    <Panel>
        <!-- 連線畫面 -->
        <Grid Name="ConnectionGrid" Background="#1a1a2e" IsVisible="True">
            <Border Background="#16213e" CornerRadius="15" BoxShadow="0 10 20 0 #55000000" 
                    HorizontalAlignment="Center" VerticalAlignment="Center" Padding="40" MaxWidth="450">
                <StackPanel Spacing="20">
                    <TextBlock Text="SMART HOME SYSTEM" Classes="h1" HorizontalAlignment="Center" Foreground="#4cc9f0"/>
                    <TextBlock Text="Secure Connection" Classes="label" HorizontalAlignment="Center"/>
                    
                    <StackPanel Spacing="5">
                        <TextBlock Text="Server URL:" Foreground="#a0a0a0"/>
                        <TextBox Name="BoxServerUrl"  Text="http://192.168.137.104:8080" Background="#0f3460" Foreground="White" BorderBrush="#4cc9f0"/>
                        <TextBlock Name="TxtServerUrlDisplay" Text="" Foreground="Red" FontSize="12" TextWrapping="Wrap"/>
                    </StackPanel>

                    <Button Classes="primary" Content="CONNECT TO SYSTEM" Click="OnConnectClick" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- 主儀表板 -->
        <Grid Name="DashboardGrid" RowDefinitions="Auto, *" IsVisible="False" Margin="10">
            <!-- 頂部標題列 -->
            <Grid Grid.Row="0" ColumnDefinitions="*, Auto" Margin="0,0,0,10">
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <TextBlock Text="SYSTEM ONLINE" VerticalAlignment="Center" Foreground="#00ff00" FontWeight="Bold"/>
                </StackPanel>
                <Button Grid.Column="1" Content="Disconnect" Background="Transparent" Foreground="#e94560" Click="OnDisconnectClick"/>
            </Grid>

            <!-- 分頁內容 -->
            <TabControl Grid.Row="1">
                
                <!-- 環境監控 (Monitor) -->
                <TabItem Header="Dash">
                    <ScrollViewer>
                        <Grid RowDefinitions="Auto, Auto, Auto, Auto" Margin="0,10,0,0">
                            
                            <!-- TX2 系統監控與風扇控制 -->
                            <Border Grid.Row="0" Classes="card" BorderBrush="#a8dadc" BorderThickness="1">
                                <StackPanel Spacing="10">
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <TextBlock Text="TX2 SYSTEM HEALTH" Classes="h2"/>
                                        <Border Background="#a8dadc" CornerRadius="4" Padding="4,2" VerticalAlignment="Center">
                                            <TextBlock Text="KERNEL" FontSize="10" Foreground="#1a1a2e" FontWeight="Bold"/>
                                        </Border>
                                    </StackPanel>
                                    
                                    <!-- CPU 溫度與風扇轉速顯示 -->
                                    <Grid ColumnDefinitions="*, *">
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="CPU Temp" Classes="label"/>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Name="TxtCpuTemp" Text="--" Classes="value" Foreground="#ff6b6b"/>
                                                <TextBlock Text="°C" VerticalAlignment="Bottom" Margin="2,0,0,3" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="Fan Speed" Classes="label"/>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Name="TxtFanSpeed" Text="--" Classes="value" Foreground="#a8dadc"/>
                                                <TextBlock Text="PWM" VerticalAlignment="Bottom" Margin="2,0,0,3" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>

                                    <!-- 風扇控制區 -->
                                    <Border Background="#0f3460" Padding="10" CornerRadius="5" Margin="0,5,0,0">
                                        <StackPanel Spacing="5">
                                            <Grid ColumnDefinitions="*, Auto">
                                                <TextBlock Text="Fan Control" VerticalAlignment="Center" FontWeight="Bold"/>
                                                <ToggleButton Name="BtnAutoFan" Content="AUTO MODE" IsChecked="True" Click="OnAutoFanToggle"/>
                                            </Grid>
                                            
                                            <Grid ColumnDefinitions="*, Auto">
                                                <Slider Name="SliderFan" Minimum="0" Maximum="255" IsEnabled="False" VerticalAlignment="Center" Margin="0,0,10,0"
                                                        PointerCaptureLost="OnFanSliderRelease"/>
                                                <TextBlock Name="TxtTargetPwm" Text="0" Width="30" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                                            </Grid>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Border>

                            <!-- TX2 Local Data -->
                            <Border Grid.Row="1" Classes="card">
                                <StackPanel Spacing="10">
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <TextBlock Text="SERVER ROOM" Classes="h2"/>
                                        <Border Background="#4cc9f0" CornerRadius="4" Padding="4,2" VerticalAlignment="Center">
                                            <TextBlock Text="LOCAL" FontSize="10" Foreground="#1a1a2e" FontWeight="Bold"/>
                                        </Border>
                                    </StackPanel>
                                    
                                    <Grid ColumnDefinitions="*, Auto">
                                        <StackPanel>
                                            <TextBlock Text="Light Intensity" Classes="label"/>
                                            <TextBlock Name="TxtLightLevel" Text="0" Classes="value" Foreground="#f7fff7"/>
                                        </StackPanel>
                                        <ProgressBar Name="BarLight" Grid.Column="1" Minimum="0" Maximum="1023" Width="100" Height="10" 
                                                     Foreground="#4cc9f0" Background="#333" VerticalAlignment="Center"/>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- MQTT Node Data -->
                            <Border Grid.Row="2" Classes="card">
                                <StackPanel Spacing="10">
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <TextBlock Text="LIVING ROOM" Classes="h2"/>
                                        <Border Background="#e94560" CornerRadius="4" Padding="4,2" VerticalAlignment="Center">
                                            <TextBlock Text="MQTT" FontSize="10" Foreground="White" FontWeight="Bold"/>
                                        </Border>
                                    </StackPanel>

                                    <Grid ColumnDefinitions="*,*,*">
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="Temp" Classes="label"/>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Name="TxtMqttTemp" Text="--" Classes="value" Foreground="#ff6b6b"/>
                                                <TextBlock Text="°C" VerticalAlignment="Bottom" Margin="2,0,0,3" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="Hum" Classes="label"/>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Name="TxtMqttHum" Text="--" Classes="value" Foreground="#4ecdc4"/>
                                                <TextBlock Text="%" VerticalAlignment="Bottom" Margin="2,0,0,3" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="Pres" Classes="label"/>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Name="TxtMqttPres" Text="--" Classes="value" Foreground="#ffe66d"/>
                                                <TextBlock Text="hPa" VerticalAlignment="Bottom" Margin="2,0,0,3" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                    <TextBlock Name="TxtMqttTime" Text="Last Update: Never" FontSize="10" Foreground="#666" HorizontalAlignment="Right"/>
                                </StackPanel>
                            </Border>

                            <!-- BT Node Data -->
                            <Border Grid.Row="3" Classes="card">
                                <StackPanel Spacing="10">
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <TextBlock Text="REMOTE UNIT" Classes="h2"/>
                                        <Border Background="#007ACC" CornerRadius="4" Padding="4,2" VerticalAlignment="Center">
                                            <TextBlock Text="BT" FontSize="10" Foreground="White" FontWeight="Bold"/>
                                        </Border>
                                    </StackPanel>

                                    <Grid ColumnDefinitions="*,*,*">
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="Temp" Classes="label"/>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Name="TxtBtTemp" Text="--" Classes="value" Foreground="#ff6b6b"/>
                                                <TextBlock Text="°C" VerticalAlignment="Bottom" Margin="2,0,0,3" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="Hum" Classes="label"/>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Name="TxtBtHum" Text="--" Classes="value" Foreground="#4ecdc4"/>
                                                <TextBlock Text="%" VerticalAlignment="Bottom" Margin="2,0,0,3" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="Pres" Classes="label"/>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Name="TxtBtPres" Text="--" Classes="value" Foreground="#ffe66d"/>
                                                <TextBlock Text="hPa" VerticalAlignment="Bottom" Margin="2,0,0,3" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                    <TextBlock Name="TxtBtTime" Text="Last Update: Never" FontSize="10" Foreground="#666" HorizontalAlignment="Right"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </ScrollViewer>
                </TabItem>

                <!-- 影像與安全 (Security) -->
                <TabItem Header="Cam">
                    <ScrollViewer>
                        <StackPanel Spacing="15" Margin="0,10,0,0">
                            <!-- 上方：影像串流 -->
                            <StackPanel Spacing="10">
                                <Border BorderBrush="#4cc9f0" BorderThickness="1" CornerRadius="5" ClipToBounds="True" Background="Black" MinHeight="240">
                                    <Panel>
                                        <Image Name="CamDisplay" Stretch="Uniform"/>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="10">
                                            <Ellipse Width="10" Height="10" Fill="Red" Margin="0,0,5,0"/>
                                            <TextBlock Text="LIVE" Foreground="Red" FontWeight="Bold"/>
                                        </StackPanel>
                                        
                                        <Border Background="#88000000" VerticalAlignment="Bottom" Padding="10">
                                            <TextBlock Name="TxtMotionStatus" Text="NO MOTION" Foreground="Lime" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        </Border>
                                    </Panel>
                                </Border>
                                <TextBlock Text="Source: CSI / USB Camera" FontSize="10" Foreground="#666" HorizontalAlignment="Right"/>
                            </StackPanel>

                            <!-- 下方：登入與日誌 -->
                            <StackPanel Spacing="15">
                                <!-- 授權區塊 -->
                                <Border Classes="card">
                                    <StackPanel Spacing="10">
                                        <TextBlock Text="ACCESS CONTROL" Classes="h2"/>
                                        
                                        <Grid ColumnDefinitions="Auto, *">
                                            <TextBlock Text="Status:" Classes="label" VerticalAlignment="Center"/>
                                            <TextBlock Name="TxtRemoteStatus" Grid.Column="1" Text="UNAUTHORIZED" 
                                                       Foreground="#e94560" FontWeight="Bold" HorizontalAlignment="Right"/>
                                        </Grid>
                                        
                                        <TextBox Name="BoxPassword"  Watermark="Driver Password" PasswordChar="•" 
                                                 Background="#0f3460" Foreground="White" BorderBrush="#333"/>
                                        
                                        <Button Name="BtnLogin" Content="Verify &amp; Log to Kernel" Classes="primary" Click="OnLoginClick"/>
                                        <TextBlock Name="TxtLoginResult" Text="" FontSize="11" Foreground="#e94560" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>

                                <!-- 日誌區塊 -->
                                <Border Classes="card" VerticalAlignment="Stretch">
                                    <StackPanel Spacing="5">
                                        <Grid ColumnDefinitions="*, Auto">
                                            <TextBlock Grid.Column="0" Text="KERNEL LOGS" Classes="h2" VerticalAlignment="Center"/>
                                            <Button Grid.Column="1" Content="⟳" Click="OnRefreshLog" Padding="10,0" Background="Transparent" Foreground="#4cc9f0" VerticalAlignment="Center"/>
                                        </Grid>
                                        
                                        <ListBox Name="ListLogs" Height="200" Background="#0f3460" Foreground="#a0a0a0" CornerRadius="5" >
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding}" FontSize="11" FontFamily="Monospace"/>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- 智慧控制 (Control) -->
                <TabItem Header="Ctrl">
                    <ScrollViewer>
                        <StackPanel Spacing="20" Margin="0,10,0,0">
                            <!-- AI -->
                            <Border Classes="card">
                                <StackPanel Spacing="10">
                                    <TextBlock Text="AI COMMAND CENTER" Classes="h2"/>
                                    
                                    <TextBox Name="BoxChat"  Watermark="Ask me anything (e.g., 'Turn on lights')" 
                                             Height="80" AcceptsReturn="True" TextWrapping="Wrap"
                                             Background="#0f3460" Foreground="White" BorderBrush="#333"/>
                                    <Button Content="SEND COMMAND" Classes="primary" Click="OnSendAiCommand"/>
                                    <Border Background="#0f3460" Padding="10" CornerRadius="5" Margin="0,10,0,0">
                                        <StackPanel>
                                            <TextBlock Text="AI Response:" Classes="label"/>
                                            <TextBlock Name="TxtAiResponse" Text="..." Foreground="#4cc9f0" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Border>

                            <!-- Smart Away -->
                            <Border Classes="card">
                                <StackPanel Spacing="10">
                                    <TextBlock Text="SMART ENERGY" Classes="h2"/>
                                    <TextBlock Text="Automatically turn off lights if no person is detected." Classes="label" TextWrapping="Wrap"/>
                                    <Button Name="BtnSmartAway" Content="RUN SMART CHECK" Classes="primary" Background="#e94560" Click="OnSmartAwayClick"/>
                                    <TextBlock Name="TxtSmartStatus" Text="Ready" HorizontalAlignment="Center" Foreground="#a0a0a0"/>
                                </StackPanel>
                            </Border>

                            <!-- LED 控制 -->
                            <Border Classes="card">
                                <StackPanel Spacing="20">
                                    <TextBlock Text="LED STATUS" Classes="h2"/>
                                    
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="20">
                                        <StackPanel Spacing="5">
                                            <Ellipse Name="Led1" Width="30" Height="30" Fill="#333" Stroke="White" StrokeThickness="1"/>
                                            <TextBlock Text="L1" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                        <StackPanel Spacing="5">
                                            <Ellipse Name="Led2" Width="30" Height="30" Fill="#333" Stroke="White" StrokeThickness="1"/>
                                            <TextBlock Text="L2" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                        <StackPanel Spacing="5">
                                            <Ellipse Name="Led3" Width="30" Height="30" Fill="#333" Stroke="White" StrokeThickness="1"/>
                                            <TextBlock Text="L3" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                        <StackPanel Spacing="5">
                                            <Ellipse Name="Led4" Width="30" Height="30" Fill="#333" Stroke="White" StrokeThickness="1"/>
                                            <TextBlock Text="L4" HorizontalAlignment="Center"/>
                                        </StackPanel>
                                    </StackPanel>
                                    
                                    <TextBlock Text="* Manual control requires keyboard (F1-F4) or advanced panel." Classes="label" HorizontalAlignment="Center" TextWrapping="Wrap"/>

                                    <Button Content="OPEN ADVANCED CONTROL PANEL" Classes="primary" Margin="0,20,0,0" Click="OnOpenLedControl"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
            </TabControl>
        </Grid>
        
        <!-- LED 控制面板 (全螢幕覆蓋層) -->
        <local:LedControlWindow Name="LedOverlay" IsVisible="False" />
    </Panel>
</UserControl>